---
title: "Immigration-Analysis-Final"
author: "Chaira Harder, Isabelle Elder, Sirohi Kumar"
format: pdf
editor: visual
---

# An Analysis of Education and Demographic Information on Successful US-Immigration

```{r}

library(dplyr)
library(ggplot2)
library(tidyverse)
library(tidytuesdayR)
library(corrplot)
library(MASS)
library(car)
# library(equatiomatic)
library(performance)
library(see)

```

## INTRODUCTION

## METHODS

### Load the data:

```{r}
# NOTE: To load data, you must download both the extract's data and the DDI
# and also set the working directory to the folder with these files (or change the path below).

if (!require("ipumsr")) stop("Reading IPUMS data into R requires the ipumsr package. It can be installed using the following command: install.packages('ipumsr')")

ddi <- read_ipums_ddi("highered_00002.xml")
data <- read_ipums_micro(ddi)
```

Wrangling:
```{r}
# remove identifier variables
data <- data |>
  dplyr::select(-PERSONID, -YEAR, -SAMPLE, -SURID, -BTHUS, -NDGMEMG, -CTZUSIN)
```

```{r}
# reconstruct the CTZUS variable to be binary.
# for CTZUS == 3, we will make that 1, and all other categories will be 0
data$CTZUS <- ifelse(data$CTZUS == 3, 1, ifelse(data$CTZUS == 98, NA, 0))

data$CHTOT[data$CHTOT == 98] <- NA

dim(data)
```


```{r}
# remove NA values
data = data |>
  dplyr::filter(!is.na(CTZUS))

dim(data)
```


```{r}
# make our model

simpleModel = glm(CTZUS ~ DGRDG + LFSTAT + CHTOT, data = data, family = binomial)
summary(simpleModel)
vif(simpleModel)
```

$$
\text{{CTZUS}} = -1.68659 + 0.12190 \text{{DGRDG}} - 0.01057 \text{{LFSTAT}} + 0.02518 \text{{CHTOT}})
$$



```{r}
# make our model

complexModel = glm(CTZUS ~ (DGRDG + LFSTAT + CHTOT) * (RACETH + GENDER), data = data, family = binomial)
summary(complexModel)
vif(complexModel)
```

$$
\text{{CTZUS}} = 1.68648 - 0.10993 \text{{DGRDG}} - 0.03052 \text{{LFSTAT}} -0.04997 \text{{CHTOT}} -1.57997 \text{{RACETH}} \\ -0.17444 \text{{GENDER}} + 0.05233 (\text{{DGRDG}} \times \text{{RACETH}}) - 0.05959 (\text{{LFSTAT}} \times \text{{RACETH}}) + \\ 0.01390 (\text{{CHTOT}} \times \text{{RACETH}}) + 0.05523 (\text{{DGRDG}} \times \text{{GENDER}}) + \\ 0.10552 (\text{{LFSTAT}} \times \text{{GENDER}}) + 0.03051 (\text{{CHTOT}} \times \text{{GENDER}})
$$

We find that 




```{r}
# make all variables characters from ints
data[] <- lapply(data, as.character)
data$CTZUS <- as.numeric(data$CTZUS)
```


```{r}
data |>
  dplyr::select(CHTOT) |>
  filter(CHTOT == 2)
```


```{r}
variableSelectionData = data |>
  filter(!is.na(CHTOT))
```

```{r}
# MODEL SELECTION

empty_model <- glm(
  CTZUS ~ 1,
  data = variableSelectionData,
  family = binomial
)

summary(empty_model)
```

```{r}

full_model <- glm(
  CTZUS ~ GENDER + RACETH + CHTOT + DGRDG + LFSTAT,
  data = variableSelectionData,
  family=binomial
)

summary(full_model)
```

```{r}
stepAIC(
  object = empty_model,
  scope = list(lower = empty_model, upper = full_model),
  direction = "forward",
  test = "F",
  k = 2*qchisq(.95, df = 1)
)
```


```{r}
stepAIC(
  full_model,
  scope = list(lower = empty_model, upper = full_model),
  direction = "backward",
  test = "F",
  k = 2*qchisq(.95, df = 1)
)
```


```{r}
stepAIC(
  object = empty_model,
  scope = list(lower = empty_model, upper = full_model),
  direction = "both",
  test = "F",
  k = 2*qchisq(.95, df = 1)
)
```

```{r}
bestModel = glm(formula = CTZUS ~ RACETH + GENDER + DGRDG + LFSTAT, family = binomial, 
    data = variableSelectionData)

summary(bestModel)
vif(bestModel)


dim(data)
```


$$
\log\left(\frac{p}{1 - p}\right) = 0.76524 - 3.71494 \cdot \text{RACETH2} - 2.38423 \cdot \text{RACETH3} + 0.33245 \cdot \text{GENDER2} + \\ 0.24602 \cdot \text{DGRDG2} + 0.30555 \cdot \text{DGRDG3} - 0.10952 \cdot \text{DGRDG4} + 0.48005 \cdot \text{LFSTAT2} - 0.08273 \cdot \text{LFSTAT3}
$$
```{r}
# this goes in Methods section
# assumptions

check_model(bestModel, check = 'all')

```


### Data wrangling:

## RESULTS

### HYPOTHESIS

## DISCUSSION

### LIMITATIONS

### FUTURE DIRECTION

## Data Appendix

#### IPUMS Citation

. Minnesota Population Center. IPUMS Higher Ed: Version 1.0 \[ImmigrationData\]. Minneapolis, MN: University of Minnesota, 2016. https://doi.org/10.18128/D100.V1.0
